<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>修改个人信息</title>
		<link rel="stylesheet" type="text/css" href="css/logandreg.css" />
		<link rel="stylesheet" type="text/css" href="layui/css/layui.css" />
	</head>

	<body>
		<div class="box">
			<div class="left">
				<div class="bggreen"></div>
				<div style="width: 220px;margin-bottom: 10px;"></div>
				<div class="bgwhite hl2" style="width: 340px;"></div>
				<div class="bgwhite hl2" style="width: 290px;"></div>
				<div class="bgwhite hl2" style="width: 310px;"></div>
				<div class="bgwhite hl2" style="width: 220px;margin-bottom: 35px;"></div>

				<div class="bggreen hl1" style="width: 140px;margin-bottom: 20px;"></div>
				<div class="bghui hl2" style="margin-bottom: 10px;width: 90px;"></div>
				<div class="bgwhite marl hl2" style="width: 100px;"></div>
				<div class="bgwhite marl hl2" style="width: 180px;"></div>
				<div class="bgwhite marl hl2" style="width: 140px;margin-bottom: 20px;"></div>

				<div class="bghui hl2" style="width: 175px;margin-bottom: 10px;"></div>
				<div class="bgwhite marl hl2" style="width: 50px;"></div>
				<div class="bgwhite marl hl2" style="width: 60px;"></div>
				<div class="bgwhite marl hl2" style="width: 120px;"></div>
				<div class="bgwhite marl hl2" style="width: 90px;margin-bottom: 20px;"></div>

				<div class="bghui hl2" style="width: 175px;"></div>
				<div class="bgwhite marl hl2" style="width: 80px;"></div>
				<div class="bgwhite marl hl2" style="width: 80px;"></div>
				<div class="bgwhite marl hl2" style="width: 65px;margin-bottom: 20px;"></div>

				<div class="bggreen hl1" style="width: 140px;"></div>
				<div class="bgwhite marl hl2" style="width: 180px;"></div>
			</div>

			<div class="right">
				<div class="hid">

					<form action="register.php" method="post" class="layui-form">
						<dd class="pic">
							<div class="img" id="img" style="background-image: url(<?php echo $userpic; ?>);"></div>
							<a href="javascript:;" class="a-upload">
								<input type="file" name="photo" title="文件不超过200kb,大小最佳为60*60" onchange="imgPreview(this)">上传头像
							</a>
						</dd>
						<span class="title">修改个人信息</span>
						<span class="inputBox nickname">昵称：<input type="text" style="width: 135px;" value=<?php echo $username ?> id="username" placeholder="请输入昵称" class="formInput"/></span>
						
						<div class="layui-clear"></div>
						
						<span class="fenlei">我的关注：(最多两项)</span>
						<div id="fenlei" class="">
							<input type="checkbox" name="Java" value="1" title="Java" lay-skin="primary" lay-filter="listType">
							<input type="checkbox" name="Web" value="2" title="Web" lay-skin="primary" lay-filter="listType">
							<input type="checkbox" name="Android" value="3" title="Android" lay-skin="primary" lay-filter="listType">
							<input type="checkbox" name="PHP" value="4" title="PHP" lay-skin="primary" lay-filter="listType">
						</div>
						<span class="fenlei">我的简介：</span>
						<textarea class="inputBox" id="intro" name="" rows="" cols="" placeholder="请输入个人简介(限五十字内)"><?php echo $userintro; ?></textarea>
						<span class="setting">帐号登录信息:</span>
						<span class="inputBox inputBase regUserName">登录邮箱：<input type="text"style="width: 190px;" disabled="disabled" value=<?php echo $userEmail; ?> id="email" placeholder="请输入登录邮箱" class="formInput"/></span>
						<span class="inputBox inputBase regPassword"><input type="password" id="password" name="password" value="" placeholder="是否修改你的密码" class="formInput"/></span>
						<span class="inputBox inputBase regPassword"><input type="password" name="reqpsw" value="" placeholder="请确认密码" class="formInput"/></span>
						<input class="form-btn login inputBase" type="button" name="" id="register" value="修改信息" onclick="subCheck()"/>
					</form>
				</div>
			</div>
		</div>

	</body>
	<script src="js/jquery-3.0.0.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="layui/layui.js" type="text/javascript" charset="utf-8"></script>
	<script>
		layui.use('form', function() {
			var form = layui.form;
		});

		
		//填充分类
		var focus = "<?php echo $focus; ?>";
		focus = focus.split('-');
		for(var i=0;i<(focus.length)-1;i++){
			var locat = 'input[name='+focus[i]+']';
			$(locat).attr('checked','checked');
		}
		
		$("#username").blur(function() {
			var uPattern = /^[a-zA-Z0-9\u4e00-\u9fa5]{3,6}$/;
			if(!uPattern.test($(this).val())) {
				$(this).val("");
				$(this).attr('placeholder', '长度为3-6个，且不能包含符号');
				$(this).focus();
			}
		});


		function subCheck() {
			var reqpsw = document.getElementsByName('reqpsw')[0];
			var username = $('#username').val();
			var intro = $('#intro').val();
			var password = $('#password').val();

			var focus='';
			var fenlei = $('#fenlei .layui-form-checked span');
			if(fenlei.length==0){
				alert("请选择要关注的分类");
				return false;
			}else if(fenlei.length>2){
				alert("关注分类不得超过两项");
				return false;
			}else{
				for(var i=0;i<fenlei.length;i++){
					focus = focus + fenlei[i].innerHTML + '-';
				}
			}
			
			if(!(password == reqpsw.value)) {
				alert("两次密码输入不一致请检查");
				return false;
			}
			var fileObj = document.getElementsByName('photo')[0].files[0];
			var formData = new FormData();
			formData.append('photo', fileObj);
			formData.append('username', username);
			formData.append('intro', intro);
			formData.append('focus', focus);
			formData.append('password', password);
			
			$.ajax({
				async:false,
				type:"post",
				url:"updatePersonInfo.php",
				data: formData ,
				processData: false,
				contentType: false,
				success:function(response,xhr){
					if(response==1){
						alert("修改成功");
						console.log(response);
						window.location.href = "myhome.php";
					}else{
//						console.log(response);
					}
				}
			});
		}

		function imgPreview(fileDom) {
			//判断是否支持FileReader
			if(window.FileReader) {
				var reader = new FileReader();
			} else {
				alert("您的设备不支持图片预览功能，如需该功能请升级您的设备！");
			}

			//获取文件
			var file = fileDom.files[0];
			var imageType = /^image\//;
			//是否是图片
			if(!imageType.test(file.type)) {
				alert("请选择图片！");
				return;
			}
			//读取完成
			reader.onload = function(e) {
				//获取图片dom
				var imgs = document.getElementById("img");

				//图片路径设置为读取的图片
				imgs.style.backgroundImage = "url(" + e.target.result + ")";
			};
			reader.readAsDataURL(file);
		}
	</script>

</html>